# Template file for 'nwg-drawer'
pkgname=nwg-drawer
version=0.4.7
revision=1
build_style=go
go_import_path=github.com/nwg-piotr/nwg-drawer
hostmakedepends="pkg-config make"
makedepends="cairo-devel gdk-pixbuf-devel gtk+3-devel gtk-layer-shell-devel pango-devel"
depends="gtk-layer-shell gtk+3 pango cairo gdk-pixbuf glib glibc fontconfig xdg-utils"
short_desc="Application drawer for wlroots-based Wayland compositors"
maintainer="zenobit <zenobit@disroot.org>"
license="MIT"
homepage="https://nwg-piotr.github.io/nwg-shell/nwg-drawer"
#changelog=""
distfiles="https://github.com/nwg-piotr/nwg-drawer/archive/refs/tags/v${version}.tar.gz"
checksum=4463841382061ef4a2d6f7fec8b9a846886edf55885cd6b2337874b5cf904e14

do_build() {
	export CGO_LDFLAGS="${LDFLAGS}"
	export CGO_CFLAGS="${CFLAGS}"
	export CGO_CPPFLAGS="${CPPFLAGS}"
	export CGO_CXXFLAGS="${CXXFLAGS}"
	export GOFLAGS="-buildmode=pie -trimpath -mod=readonly -modcacherw -ldflags=-linkmode=external"
	export GOPATH="${srcdir}"/go
	export PATH=$PATH:$GOPATH/bin
	go build -o bin/"$pkgname" *.go
}

post_install() {
	for file in desktop-directories/*; do
		vinstall ${file} 644 /usr/share/nwg-drawer/desktop-directories
	done

	for img in img/*.svg; do
		vinstall "${img}" 644 /usr/share/nwg-drawer/img
	done

	vinstall drawer.css 644 /usr/share/nwg-drawer

	vbin bin/nwg-drawer

	vinstall README.md 644 /usr/share/doc/nwg-drawer
	vlicense LICENSE
}
