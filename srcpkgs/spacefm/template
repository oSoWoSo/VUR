# Template file for 'spacefm'
pkgname=spacefm
version=2.1.2
revision=1
build_style=meson
wrksrc="${pkgname}-${version}"
create_wrksrc=yes
configure_args="$(vopt_with gtk3)"
hostmakedepends="pkg-config intltool xdg-utils xbps-triggers"
makedepends="$(vopt_if gtk3 gtk+3-devel gtk+-devel)
 startup-notification-devel eudev-libudev-devel ffmpegthumbnailer-devel xdg-utils"
depends="hicolor-icon-theme desktop-file-utils"
short_desc="NOT WORKING YET! Multi-panel tabbed file manager"
maintainer="zenobit from oSoWoSo <pm@osowoso.xyz>"
license="GPL-3.0-or-later"
homepage="https://github.com/thermitegod/spacefm"
distfiles="https://github.com/oSoWoSo/${pkgname}/archive/${version}.tar.gz"
checksum=fa3f17910a9620f88a80c3a4c8dc9de5ba56255e0cb05227ac0c505988f6d6e9
conf_files="/etc/spacefm/spacefm.conf"

build_options="gtk3 deprecated-hw mmap xxhash nonlatin sn"
build_options_default="gtk3 mmap xxhash sn"
CFLAGS="-fcommon"

src_configure() {
	meson_src_configure \
		$(meson_use startup-notification sn) \
		$(meson_use deprecated deprecated-hw) \
		$(meson_use xxhash xxhash)

}

src_compile() {
	meson_src_compile
}

src_install() {
	meson_src_install
	einstalldocs
	doman doc/*.1
	doman doc/*.7
}

pkg_postinst() {
	xdg_desktop_database_update
	xdg_mimeinfo_database_update
	xdg_icon_cache_update
}

pkg_postrm() {
	xdg_desktop_database_update
	xdg_mimeinfo_database_update
	xdg_icon_cache_update
}

post_patch() {
	vsed -i -e '/DATADIRNAME=/s/=.*/=share/' configure
}
