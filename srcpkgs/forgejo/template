# Template file for 'forgejo'
pkgname=forgejo
version=1.20.4.1
revision=1
_forgejo_version="${version%.*}-${version##*.}"
build_style=go
go_import_path="code.gitea.io/gitea"
go_ldflags="-X main.Version=${version%.*}"
go_build_tags="bindata pam sqlite tidb"
hostmakedepends="go-bindata"
makedepends="pam-devel sqlite-devel"
depends="bash git"
short_desc="Self-hosted lightweight software forge"
maintainer="Marcin Puc <tranzystorek.io@protonmail.com>"
license="MIT"
homepage="https://forgejo.org/"
changelog="https://codeberg.org/forgejo/forgejo/raw/branch/forgejo/RELEASE-NOTES.md"
distfiles="https://codeberg.org/forgejo/forgejo/releases/download/v${_forgejo_version}/forgejo-src-${_forgejo_version}.tar.gz"
checksum=732281d0f31d284499fd2a3708bd06250a7cfdad422e07886adb67a195881910

system_accounts="_forgejo"
_forgejo_homedir="/var/lib/forgejo"
_forgejo_descr="Self-hosted lightweight software forge service"
_forgejo_shell="/bin/bash"
make_dirs="/var/lib/forgejo 0755 _forgejo _forgejo
 /var/log/forgejo 0755 _forgejo root"
conf_files="/etc/forgejo.conf"

post_install() {
	vinstall custom/conf/app.example.ini 640 etc forgejo.conf
	vlicense LICENSE
	vsv forgejo

	mv "${DESTDIR}/usr/bin"/{gitea,forgejo}
}
