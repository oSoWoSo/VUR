# Template file for 'zen-browser'
pkgname=zen-browser
version=1.17.5b
revision=1
archs="x86_64 aarch64"
hostmakedepends="curl xz"
depends="desktop-file-utils hicolor-icon-theme libnotify libavcodec xdg-utils"
short_desc="Experience tranquillity while browsing the web without people tracking you!"
maintainer="Encoded14 <linusken@tuta.io>"
license="MPL-2.0"
homepage="https://www.zen-browser.app/"
changelog="https://github.com/zen-browser/desktop/releases"
case "$XBPS_TARGET_MACHINE" in
x86_64)
	distfiles="https://github.com/zen-browser/desktop/releases/download/${version}/zen.linux-x86_64.tar.xz"
	checksum=5f94353ae1236d4584f18f04e38e92aafaa9a04c654d1c3d4794ccd1eb11ccff
	;;
aarch64)
	distfiles="https://github.com/zen-browser/desktop/releases/download/${version}/zen.linux-aarch64.tar.xz"
	checksum=0c356e73185f3343d3a24444d97417b296a2d547910ae2285e5e02398658019b
	;;
*)
	broken="No distfiles available for this target"
	;;
esac

do_install() {
    install -dm755 "${DESTDIR}/opt/${pkgname}" "${DESTDIR}/usr/bin" "${DESTDIR}/usr/share/applications" "${DESTDIR}/usr/share/pixmaps"

    vinstall "${FILESDIR}/zen.desktop" 0644 usr/share/applications/

    vcopy * "opt/${pkgname}"

    ln -sf "/opt/${pkgname}/zen" "${DESTDIR}/usr/bin/zen"

    install -dm755 "${DESTDIR}/opt/${pkgname}/distribution"
    vinstall ${FILESDIR}/policies.json 644 "opt/${pkgname}/distribution/"

    vinstall browser/chrome/icons/default/default48.png 0644 usr/share/pixmaps zen.png
    for size in 16 32 48 64 128; do
        install -d ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps
        vinstall browser/chrome/icons/default/default${size}.png 0644 usr/share/icons/hicolor/${size}x${size}/apps zen.png
    done

    ln -Ts /usr/share/hunspell "${DESTDIR}/opt/${pkgname}/dictionaries"
    ln -Ts /usr/share/hyphen "${DESTDIR}/opt/${pkgname}/hyphenation"
    ln -sf /usr/lib/libnssckbi.so "${DESTDIR}/opt/${pkgname}/libnssckbi.so"
}

post_install() {
    curl --fail -sOL https://raw.githubusercontent.com/zen-browser/desktop/refs/heads/dev/LICENSE
    vlicense LICENSE
}
