# Template file for 'kando'
pkgname=kando
version=1.7.0
revision=1
build_style=cmake
hostmakedepends="pkg-config nodejs"
makedepends="wayland-devel libX11-devel libXtst-devel libxkbcommon-devel"
#depends=""
short_desc="Do things with utmost efficiency"
maintainer="zenobit <zenobit@disroot.org>"
license="MIT"
homepage="https://kando.menu"
changelog="https://github.com/kando-menu/kando/blob/main/docs/changelog.md"
distfiles="https://github.com/kando-menu/kando/archive/refs/tags/v${version}.tar.gz"
checksum=c3461edae6082e8616e4a75a2842b1cee8c4a80d779ca14d80c1907352014ef4

pre_configure() {
	npm install
}

do_build() {
	npm run package
}

do_install() {
	mkdir -p usr/lib/kando
	cp -r out/Kando-linux-x64/* usr/lib/kando/
	mkdir -p usr/bin
	cat >> usr/bin/kando << 'EOF'
#!/bin/sh
exec /usr/lib/kando/kando --no-sandbox "$@"
EOF
	mkdir -p usr/share/icons
	cp appstream/menu.kando.Kando.svg usr/share/icons/
	cp assets/icons/*.png usr/share/icons/
	mkdir -p usr/share/applications
	cp appstream/menu.kando.Kando.desktop usr/share/applications/
}

post_install() {
	vcopy usr/lib/kando /usr/lib/kando
	vmkdir usr/share/icons
	vcopy usr/share/icons usr/share/icons
	vmkdir usr/share/applications
	vcopy usr/share/applications usr/share/applications
	vbin usr/bin/kando
	for f in docs/*.md; do
		vdoc "$f"
	done
	vlicense usr/lib/kando/LICENSE
}
