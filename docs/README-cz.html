<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README-cz</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
<script>
  function toggleTheme(){
    const html=document.documentElement;
    const current=html.getAttribute("data-theme")||"dark";
    const next=current==="dark"?"light":"dark";
    html.setAttribute("data-theme",next);
    localStorage.setItem("theme",next)
  }
  (function(){
    const saved=localStorage.getItem("theme")||"dark";
    document.documentElement.setAttribute("data-theme",saved)
  })();
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toc = document.getElementById("TOC");
    if (!toc) return;

    // Add toc-title with toggle button
    const titleEl = document.createElement("div");
    titleEl.id = "toc-title";
    titleEl.innerHTML = '<span>Contents</span><span id="toc-toggle-icon">â—€</span>';
    toc.insertBefore(titleEl, toc.firstChild);

    // Wrap TOC + the rest of the content in .page-wrapper
    const body = document.body;
    const wrapper = document.createElement("div");
    wrapper.className = "page-wrapper";

    // Find all elements after <nav> (main nav menu)
    const topNav = document.querySelector("body > nav");
    const siblings = [];
    let el = topNav ? topNav.nextElementSibling : body.firstElementChild;
    while (el) {
      siblings.push(el);
      el = el.nextElementSibling;
    }

    siblings.forEach((s) => wrapper.appendChild(s));
    body.appendChild(wrapper);

    // Wrap main content (everything except TOC) in .main-content
    const mainContent = document.createElement("div");
    mainContent.className = "main-content";
    Array.from(wrapper.children).forEach((child) => {
      if (child.id !== "TOC") mainContent.appendChild(child);
    });
    wrapper.appendChild(mainContent);

    // Collapsible toggle
    const icon = document.getElementById("toc-toggle-icon");
    const saved = localStorage.getItem("toc-collapsed");
    if (saved === "true") {
      toc.classList.add("collapsed");
      icon.textContent = "â–¶";
    }

    titleEl.addEventListener("click", function () {
      toc.classList.toggle("collapsed");
      const isCollapsed = toc.classList.contains("collapsed");
      icon.textContent = isCollapsed ? "â–¶" : "â—€";
      localStorage.setItem("toc-collapsed", isCollapsed);
    });
  });
</script>
<nav><ul>
  <li><a href="https://osowoso.org">oSoWoSo</a></li>
  <li>â®ï¸</a></li>
  <li><a href="index.html">Home</a></li>
  <li><a class="no-release" href="https://github.com/oSoWoSo/VUR/releases/latest">â¬ release</a></li>
  <li><a href="https://github.com/oSoWoSo/VUR/archive/refs/heads/main.zip">ğŸ“¦repo zip</a></li>
  <li><a href="https://github.com/oSoWoSo/VUR">ğŸ”—git</a></li>
  <li>â­ï¸</a></li>
  <li><a href="CONTRIBUTING-cz.html">CONTRIBUTING-cz</a></li>
  <li><a href="CONTRIBUTING.html">CONTRIBUTING</a></li>
  <li><a href="Manual-cz.html">Manual-cz</a></li>
  <li><a href="Manual.html">Manual</a></li>
  <li><a href="README-cz.html" class="active">README-cz</a></li>
</ul></nav>
<header id="title-block-header">
<h1 class="title">README-cz</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#kolekce-zdrojovÃ½ch-balÃ­ÄkÅ¯-xbps"
id="toc-kolekce-zdrojovÃ½ch-balÃ­ÄkÅ¯-xbps">Kolekce zdrojovÃ½ch balÃ­ÄkÅ¯
XBPS</a>
<ul>
<li><a href="#obsah" id="toc-obsah">Obsah</a></li>
<li><a href="#poÅ¾adavky" id="toc-poÅ¾adavky">PoÅ¾adavky</a></li>
<li><a href="#rychlÃ½-start" id="toc-rychlÃ½-start">RychlÃ½ start</a></li>
<li><a href="#chroot-metody" id="toc-chroot-metody">chroot
metody</a></li>
<li><a href="#nainstalujte-bootstrap-balÃ­Äky"
id="toc-nainstalujte-bootstrap-balÃ­Äky">Nainstalujte bootstrap
balÃ­Äky</a></li>
<li><a href="#konfigurace" id="toc-konfigurace">Konfigurace</a></li>
<li><a href="#hierarchie-adresÃ¡Å™Å¯"
id="toc-hierarchie-adresÃ¡Å™Å¯">Hierarchie adresÃ¡Å™Å¯</a></li>
<li><a href="#stavebnÃ­-balÃ­Äky" id="toc-stavebnÃ­-balÃ­Äky">StavebnÃ­
balÃ­Äky</a></li>
<li><a href="#moÅ¾nosti-sestavenÃ­-balÃ­Äku"
id="toc-moÅ¾nosti-sestavenÃ­-balÃ­Äku">MoÅ¾nosti sestavenÃ­ balÃ­Äku</a></li>
<li><a href="#sdÃ­lenÃ­-a-podepisovÃ¡nÃ­-mÃ­stnÃ­ch-ÃºloÅ¾iÅ¡Å¥"
id="toc-sdÃ­lenÃ­-a-podepisovÃ¡nÃ­-mÃ­stnÃ­ch-ÃºloÅ¾iÅ¡Å¥">SdÃ­lenÃ­ a podepisovÃ¡nÃ­
mÃ­stnÃ­ch ÃºloÅ¾iÅ¡Å¥</a></li>
<li><a
href="#opÄ›tovnÃ©-sestavenÃ­-a-pÅ™epsÃ¡nÃ­-existujÃ­cÃ­ch-mÃ­stnÃ­ch-balÃ­ÄkÅ¯"
id="toc-opÄ›tovnÃ©-sestavenÃ­-a-pÅ™epsÃ¡nÃ­-existujÃ­cÃ­ch-mÃ­stnÃ­ch-balÃ­ÄkÅ¯">OpÄ›tovnÃ©
sestavenÃ­ a pÅ™epsÃ¡nÃ­ existujÃ­cÃ­ch mÃ­stnÃ­ch balÃ­ÄkÅ¯</a></li>
<li><a href="#povolenÃ­-distcc-pro-distribuovanou-kompilaci"
id="toc-povolenÃ­-distcc-pro-distribuovanou-kompilaci">PovolenÃ­ distcc
pro distribuovanou kompilaci</a></li>
<li><a href="#zrcadla-distfiles" id="toc-zrcadla-distfiles">Zrcadla
Distfiles</a></li>
<li><a href="#kÅ™Ã­Å¾ovÃ¡-kompilace-balÃ­ÄkÅ¯-pro-cÃ­lovou-architekturu"
id="toc-kÅ™Ã­Å¾ovÃ¡-kompilace-balÃ­ÄkÅ¯-pro-cÃ­lovou-architekturu">KÅ™Ã­Å¾ovÃ¡
kompilace balÃ­ÄkÅ¯ pro cÃ­lovou architekturu</a></li>
<li><a href="#pouÅ¾itÃ­-xbps-src-v-zahraniÄnÃ­-distribuci-linuxu"
id="toc-pouÅ¾itÃ­-xbps-src-v-zahraniÄnÃ­-distribuci-linuxu">PouÅ¾itÃ­
xbps-src v zahraniÄnÃ­ distribuci Linuxu</a></li>
<li><a href="#pÅ™edÄ›lat-masterdir" id="toc-pÅ™edÄ›lat-masterdir">PÅ™edÄ›lat
masterdir</a></li>
<li><a href="#udrÅ¾ujte-svÅ¯j-masterdir-aktuÃ¡lnÃ­"
id="toc-udrÅ¾ujte-svÅ¯j-masterdir-aktuÃ¡lnÃ­">UdrÅ¾ujte svÅ¯j masterdir
aktuÃ¡lnÃ­</a></li>
<li><a href="#vytvÃ¡Å™enÃ­-32bitovÃ½ch-balÃ­ÄkÅ¯-na-x86_64"
id="toc-vytvÃ¡Å™enÃ­-32bitovÃ½ch-balÃ­ÄkÅ¯-na-x86_64">VytvÃ¡Å™enÃ­ 32bitovÃ½ch
balÃ­ÄkÅ¯ na x86_64</a></li>
<li><a href="#nativnÃ­-vytvÃ¡Å™enÃ­-balÃ­ÄkÅ¯-pro-knihovnu-musl-c"
id="toc-nativnÃ­-vytvÃ¡Å™enÃ­-balÃ­ÄkÅ¯-pro-knihovnu-musl-c">NativnÃ­ vytvÃ¡Å™enÃ­
balÃ­ÄkÅ¯ pro knihovnu musl C</a></li>
<li><a href="#budovÃ¡nÃ­-prÃ¡zdnÃ©ho-zÃ¡kladnÃ­ho-systÃ©mu-od-nuly"
id="toc-budovÃ¡nÃ­-prÃ¡zdnÃ©ho-zÃ¡kladnÃ­ho-systÃ©mu-od-nuly">BudovÃ¡nÃ­
prÃ¡zdnÃ©ho zÃ¡kladnÃ­ho systÃ©mu od nuly</a></li>
</ul></li>
</ul>
</nav>
<h2 id="kolekce-zdrojovÃ½ch-balÃ­ÄkÅ¯-xbps">Kolekce zdrojovÃ½ch balÃ­ÄkÅ¯
XBPS</h2>
<p>Toto ÃºloÅ¾iÅ¡tÄ› obsahuje kolekci zdrojovÃ½ch balÃ­ÄkÅ¯ XBPS pro sestavenÃ­
binÃ¡rnÃ­ch balÃ­ÄkÅ¯ pro distribuci Void Linux.</p>
<p>ZahrnutÃ½ skript <code>xbps-src</code> naÄte a zkompiluje zdrojovÃ©
kÃ³dy a nainstaluje svÃ© soubory do <code>fake destdir</code> aby se
vygenerovaly binÃ¡rnÃ­ balÃ­Äky XBPS, kterÃ© lze nainstalovat nebo se na nÄ›
lze dotazovat pomocÃ­ nÃ¡strojÅ¯ <code>xbps-install(1)</code> a
<code>xbps-query(1)</code> . .</p>
<p>ObecnÃ½ pÅ™ehled o tom, jak pÅ™ispÃ­vat, najdete v ÄÃ¡sti <a
href="./CONTRIBUTING.md">PÅ™ispÃ­vÃ¡nÃ­</a> a podrobnosti o vytvÃ¡Å™enÃ­
zdrojovÃ½ch balÃ­ÄkÅ¯ najdete <a href="./Manual.md">v pÅ™Ã­ruÄce</a> .</p>
<h3 id="obsah">Obsah</h3>
<ul>
<li><a href="#requirements">PoÅ¾adavky</a></li>
<li><a href="#quick-start">RychlÃ½ start</a></li>
<li><a href="#chroot-methods">chroot metody</a></li>
<li><a href="#install-bootstrap">Nainstalujte bootstrap balÃ­Äky</a></li>
<li><a href="#configuration">Konfigurace</a></li>
<li><a href="#directory-hierarchy">Hierarchie adresÃ¡Å™Å¯</a></li>
<li><a href="#building-packages">StavebnÃ­ balÃ­Äky</a></li>
<li><a href="#build-options">MoÅ¾nosti sestavenÃ­ balÃ­Äku</a></li>
<li><a href="#sharing-and-signing">SdÃ­lenÃ­ a podepisovÃ¡nÃ­ mÃ­stnÃ­ch
ÃºloÅ¾iÅ¡Å¥</a></li>
<li><a href="#rebuilding">OpÄ›tovnÃ© sestavenÃ­ a pÅ™epsÃ¡nÃ­ existujÃ­cÃ­ch
mÃ­stnÃ­ch balÃ­ÄkÅ¯</a></li>
<li><a href="#distcc">PovolenÃ­ distcc pro distribuovanou
kompilaci</a></li>
<li><a href="#distfiles-mirrors">Zrcadla Distfiles</a></li>
<li><a href="#cross-compiling">KÅ™Ã­Å¾ovÃ¡ kompilace balÃ­ÄkÅ¯ pro cÃ­lovou
architekturu</a></li>
<li><a href="#foreign">PouÅ¾itÃ­ xbps-src v zahraniÄnÃ­ distribuci
Linuxu</a></li>
<li><a href="#remaking-masterdir">PÅ™edÄ›lat masterdir</a></li>
<li><a href="#updating-masterdir">UdrÅ¾ujte svÅ¯j masterdir
aktuÃ¡lnÃ­</a></li>
<li><a href="#building-32bit">VytvÃ¡Å™enÃ­ 32bitovÃ½ch balÃ­ÄkÅ¯ na
x86_64</a></li>
<li><a href="#building-for-musl">NativnÃ­ vytvÃ¡Å™enÃ­ balÃ­ÄkÅ¯ pro knihovnu
musl C</a></li>
<li><a href="#building-base-system">BudovÃ¡nÃ­ prÃ¡zdnÃ©ho zÃ¡kladnÃ­ho
systÃ©mu od nuly</a></li>
</ul>
<h3 id="poÅ¾adavky">PoÅ¾adavky</h3>
<ul>
<li>GNU bash</li>
<li>xbps &gt;= 0,56</li>
<li>git(1) - pokud nenÃ­ nakonfigurovÃ¡no, viz etc/defaults.conf</li>
<li>bÄ›Å¾nÃ© nÃ¡stroje POSIX, kterÃ© jsou standardnÄ› souÄÃ¡stÃ­ tÃ©mÄ›Å™ vÅ¡ech
systÃ©mÅ¯ UNIX</li>
<li>curl(1) - vyÅ¾aduje <code>xbps-src update-check</code></li>
</ul>
<p>Pro bootstrapping ze zdrojovÃ©ho kÃ³du navÃ­c:</p>
<ul>
<li>flock(1) - util-linux</li>
<li>bsdtar nebo GNU tar (v tomto poÅ™adÃ­ preferencÃ­)</li>
<li>install(1) - GNU coreutils</li>
<li>objcopy(1), objdump(1), strip(1): binutils</li>
</ul>
<p><code>xbps-src</code> vyÅ¾aduje <a href="#chroot-methods">obsluÅ¾nÃ½
program pro chroot</a> a svÃ¡zÃ¡nÃ­ pÅ™ipojenÃ­ existujÃ­cÃ­ch adresÃ¡Å™Å¯ do
<code>masterdir</code> , kterÃ½ se pouÅ¾Ã­vÃ¡ jako jeho hlavnÃ­
<code>chroot</code> adresÃ¡Å™. <code>xbps-src</code> podporuje vÃ­ce
obsluÅ¾nÃ½ch programÅ¯ k provedenÃ­ tohoto Ãºkolu.</p>
<blockquote>
<p>POZNÃMKA: <code>xbps-src</code> jiÅ¾ neumoÅ¾Åˆuje sestavenÃ­ jako root.
PouÅ¾ijte jednu z metod chroot.</p>
</blockquote>
<p><a name="quick-start"></a></p>
<h3 id="rychlÃ½-start">RychlÃ½ start</h3>
<p>Klonujte git repozitÃ¡Å™ <code>void-packages</code> :</p>
<pre><code>$ git clone https://github.com/void-linux/void-packages.git
$ cd void-packages</code></pre>
<p>Bootstrapping z binÃ¡rnÃ­ch balÃ­ÄkÅ¯ se provede automaticky pÅ™i prvnÃ­m
sestavenÃ­ balÃ­Äku, ale lze jej provÃ©st ruÄnÄ› pomocÃ­:</p>
<pre><code>$ ./xbps-src binary-bootstrap</code></pre>
<p>Sestavte balÃ­Äek zadÃ¡nÃ­m <code>pkg</code> a nÃ¡zvu balÃ­Äku:</p>
<pre><code>$ ./xbps-src pkg &lt;package_name&gt;</code></pre>
<p>PomocÃ­ <code>./xbps-src -h</code> vypÃ­Å¡ete vÅ¡echny dostupnÃ© cÃ­le a
moÅ¾nosti.</p>
<p>Chcete-li sestavit balÃ­Äky oznaÄenÃ© jako 'omezenÃ©', upravte
<code>etc/conf</code> :</p>
<pre><code>$ echo XBPS_ALLOW_RESTRICTED=yes &gt;&gt; etc/conf</code></pre>
<p>Po sestavenÃ­ bude balÃ­Äek dostupnÃ½ v <code>hostdir/binpkgs</code>
nebo v pÅ™Ã­sluÅ¡nÃ©m podadresÃ¡Å™i (napÅ™.
<code>hostdir/binpkgs/nonfree</code> ). Instalace balÃ­Äku:</p>
<pre><code># xbps-install --repository hostdir/binpkgs &lt;package_name&gt;</code></pre>
<p>AlternativnÄ› lze balÃ­Äky nainstalovat pomocÃ­ nÃ¡stroje <code>xi</code>
z balÃ­Äku <code>xtools</code> . <code>xi</code> bere v Ãºvahu ÃºloÅ¾iÅ¡tÄ›
aktuÃ¡lnÃ­ho pracovnÃ­ho adresÃ¡Å™e.</p>
<pre><code>$ xi &lt;package_name&gt;</code></pre>
<p><a name="chroot-methods"></a></p>
<h3 id="chroot-metody">chroot metody</h3>
<h4 id="xbps-uunshare1-vÃ½chozÃ­">xbps-uunshare(1) (vÃ½chozÃ­)</h4>
<p>NÃ¡stroj XBPS, kterÃ½ pouÅ¾Ã­vÃ¡ <code>user_namespaces(7)</code> (souÄÃ¡st
xbps, vÃ½chozÃ­ bez parametru <code>-t</code> ).</p>
<p>Tento nÃ¡stroj vyÅ¾aduje tyto moÅ¾nosti jÃ¡dra Linux:</p>
<ul>
<li>CONFIG_NAMESPACES</li>
<li>CONFIG_IPC_NS</li>
<li>CONFIG_UTS_NS</li>
<li>CONFIG_USER_NS</li>
</ul>
<p>Toto je vÃ½chozÃ­ metoda, a pokud vÃ¡Å¡ systÃ©m nepodporuje Å¾Ã¡dnou z
poÅ¾adovanÃ½ch voleb jÃ¡dra, selÅ¾e s <code>EINVAL (Invalid argument)</code>
.</p>
<h4 id="xbps-uchroot1">xbps-uchroot(1)</h4>
<p>NÃ¡stroj XBPS, kterÃ½ pouÅ¾Ã­vÃ¡ <code>namespaces</code> a musÃ­ bÃ½t
<code>setgid</code> (souÄÃ¡st xbps).</p>
<blockquote>
<p>POZNÃMKA: Toto je jedinÃ¡ metoda, kterÃ¡ implementuje funkci
<code>xbps-src -t</code> , proto pÅ™Ã­znak ignoruje volbu provedenou v
konfiguraÄnÃ­ch souborech a povolÃ­ <code>xbps-uchroot</code> .</p>
</blockquote>
<p>Tento nÃ¡stroj vyÅ¾aduje tyto moÅ¾nosti jÃ¡dra Linux:</p>
<ul>
<li>CONFIG_NAMESPACES</li>
<li>CONFIG_IPC_NS</li>
<li>CONFIG_PID_NS</li>
<li>CONFIG_UTS_NS</li>
</ul>
<p>VÃ¡Å¡ uÅ¾ivatel musÃ­ bÃ½t pÅ™idÃ¡n do speciÃ¡lnÃ­ skupiny, aby mohl pouÅ¾Ã­vat
<code>xbps-uchroot(1)</code> a spustitelnÃ½ soubor musÃ­ bÃ½t
<code>setgid</code> :</p>
<pre><code># chown root:&lt;group&gt; xbps-uchroot
# chmod 4750 xbps-uchroot
# usermod -a -G &lt;group&gt; &lt;user&gt;</code></pre>
<blockquote>
<p>POZNÃMKA: ve vÃ½chozÃ­m nastavenÃ­ byste to nemÄ›li dÄ›lat ruÄnÄ›, vÃ¡Å¡
uÅ¾ivatel musÃ­ bÃ½t Älenem skupiny <code>xbuilder</code> .</p>
</blockquote>
<p>Chcete-li to povolit:</p>
<pre><code>$ cd void-packages
$ echo XBPS_CHROOT_CMD=uchroot &gt;&gt; etc/conf</code></pre>
<p>Pokud se z nÄ›jakÃ©ho dÅ¯vodu chybuje jako
<code>ERROR clone (Operation not permitted)</code> , zkontrolujte, zda
je vÃ¡Å¡ uÅ¾ivatel Älenem poÅ¾adovanÃ© <code>group</code> a Å¾e nÃ¡stroj
<code>xbps-uchroot(1)</code> mÃ¡ sprÃ¡vnÃ¡ oprÃ¡vnÄ›nÃ­ a vlastnÃ­ka/skupinu,
jak je vysvÄ›tleno vÃ½Å¡e.</p>
<h4 id="bwrap-1">bwrap (1)</h4>
<p>bubblewrap, sandboxingovÃ½ nÃ¡stroj pro neprivilegovanÃ© uÅ¾ivatele,
kterÃ½ pouÅ¾Ã­vÃ¡ uÅ¾ivatelskÃ© jmennÃ© prostory nebo setuid. Viz <a
href="https://github.com/containers/bubblewrap"><span>https://github.com/containers/bubblewrap</span></a>
.</p>
<h4 id="Ã©terickÃ½">Ã©terickÃ½</h4>
<p>ZniÄÃ­ hostitelskÃ½ systÃ©m, na kterÃ©m bÄ›Å¾Ã­. UÅ¾iteÄnÃ© pouze pro
jednorÃ¡zovÃ© kontejnery, tj. docker (pouÅ¾Ã­vÃ¡ se s CI).</p>
<p><a name="install-bootstrap"></a></p>
<h3 id="nainstalujte-bootstrap-balÃ­Äky">Nainstalujte bootstrap
balÃ­Äky</h3>
<p>Existuje sada balÃ­ÄkÅ¯, kterÃ© tvoÅ™Ã­ poÄÃ¡teÄnÃ­ kontejner sestavenÃ­,
nazÃ½vanÃ½ <code>bootstrap</code> . Tyto balÃ­Äky se instalujÃ­ do
<code>masterdir</code> za ÃºÄelem vytvoÅ™enÃ­ kontejneru.</p>
<p>PrimÃ¡rnÃ­m a doporuÄenÃ½m zpÅ¯sobem nastavenÃ­ tohoto kontejneru je
pouÅ¾itÃ­ pÅ™Ã­kazu <code>binary-bootstrap</code> . PouÅ¾ije se jiÅ¾
existujÃ­cÃ­ binÃ¡rnÃ­ balÃ­Äky, buÄ ze vzdÃ¡lenÃ½ch repozitÃ¡Å™Å¯
<code>xbps</code> , nebo z vaÅ¡eho lokÃ¡lnÃ­ho repozitÃ¡Å™e. To se provÃ¡dÃ­
automaticky pÅ™i sestavovÃ¡nÃ­ balÃ­ÄkÅ¯, pokud neexistuje inicializovanÃ½
hlavnÃ­ adresÃ¡Å™ pro hostitelskou architekturu.</p>
<p>K dispozici je takÃ© pÅ™Ã­kaz <code>bootstrap</code> , kterÃ½ vytvoÅ™Ã­
vÅ¡echny potÅ™ebnÃ© <code>bootstrap</code> balÃ­Äky od zaÄÃ¡tku. To se
obvykle nedoporuÄuje, protoÅ¾e tyto balÃ­Äky jsou sestaveny pomocÃ­
toolchainu vaÅ¡eho hostitelskÃ©ho systÃ©mu a nejsou ani plnÄ› vybavenÃ© ani
reprodukovatelnÃ© (vÃ¡Å¡ hostitelskÃ½ systÃ©m mÅ¯Å¾e ovlivnit sestavenÃ­), a
proto by mÄ›ly bÃ½t pouÅ¾ity pouze jako fÃ¡ze 0 pro bootstraping novÃ½ch Void
systÃ©mÅ¯.</p>
<p>Pokud se pÅ™esto rozhodnete pouÅ¾Ã­t <code>bootstrap</code> , pouÅ¾ijte
vÃ½slednÃ½ kontejner fÃ¡ze 0 k opÄ›tovnÃ©mu sestavenÃ­ vÅ¡ech balÃ­ÄkÅ¯
<code>bootstrap</code> , potÃ© pouÅ¾ijte <code>binary-bootstrap</code>
(fÃ¡ze 1) a znovu sestavte balÃ­Äky <code>bootstrap</code> (pro zÃ­skÃ¡nÃ­
fÃ¡ze 2 a potÃ© znovu pouÅ¾ijte <code>binary-bootstrap</code> ). Jakmile to
udÄ›lÃ¡te, budete mÃ­t sadu <code>bootstrap</code> ekvivalentnÃ­ pouÅ¾itÃ­
<code>binary-bootstrap</code> .</p>
<p>TakÃ© mÄ›jte na pamÄ›ti, Å¾e <code>bootstrap</code> ÃºplnÃ©ho zdroje je
ÄasovÄ› nÃ¡roÄnÃ© a bude vyÅ¾adovat instalaci Å™ady utilit ve vaÅ¡em
hostitelskÃ©m systÃ©mu, jako jsou <code>binutils</code> , <code>gcc</code>
, <code>perl</code> , <code>texinfo</code> a dalÅ¡Ã­.</p>
<h3 id="konfigurace">Konfigurace</h3>
<p>Soubor <code>etc/defaults.conf</code> obsahuje moÅ¾nÃ¡ nastavenÃ­, kterÃ¡
lze pÅ™epsat pomocÃ­ konfiguraÄnÃ­ho souboru <code>etc/conf</code> pro
obsluÅ¾nÃ½ program <code>xbps-src</code> ; pokud tento soubor neexistuje,
pokusÃ­ se naÄÃ­st konfiguraÄnÃ­ nastavenÃ­ z
<code>$XDG_CONFIG_HOME/xbps-src.conf</code> ,
<code>~/.config/xbps-src.conf</code> , <code>~/.xbps-src.conf</code>
.</p>
<p>Pokud chcete upravit vÃ½chozÃ­ <code>CFLAGS</code> ,
<code>CXXFLAGS</code> a <code>LDFLAGS</code> , nepÅ™episujte ty
definovanÃ© v <code>etc/defaults.conf</code> , nastavte je na
<code>etc/conf</code> , tj.</p>
<pre><code>$ echo &#39;XBPS_CFLAGS=&quot;your flags here&quot;&#39; &gt;&gt; etc/conf
$ echo &#39;XBPS_LDFLAGS=&quot;your flags here&quot;&#39; &gt;&gt; etc/conf</code></pre>
<p>NativnÃ­ a kÅ™Ã­Å¾ovÃ½ kompilÃ¡tor/linker pÅ™Ã­znaky jsou nastaveny pro
architekturu v <code>common/build-profiles</code> a
<code>common/cross-profiles</code> . V ideÃ¡lnÃ­m pÅ™Ã­padÄ› jsou tato
nastavenÃ­ ve vÃ½chozÃ­m nastavenÃ­ dostateÄnÄ› dobrÃ¡ a nenÃ­ tÅ™eba nastavovat
vlastnÃ­, pokud nevÃ­te, co dÄ›lÃ¡te.</p>
<h4 id="virtuÃ¡lnÃ­-balÃ­Äky">VirtuÃ¡lnÃ­ balÃ­Äky</h4>
<p>Soubor <code>etc/defaults.virtual</code> obsahuje vÃ½chozÃ­ nÃ¡hrady za
virtuÃ¡lnÃ­ balÃ­Äky, kterÃ© se pouÅ¾Ã­vajÃ­ jako zÃ¡vislosti ve stromu
zdrojovÃ½ch balÃ­ÄkÅ¯.</p>
<p>Pokud chcete tyto nÃ¡hrady pÅ™izpÅ¯sobit, zkopÃ­rujte
<code>etc/defaults.virtual</code> do <code>etc/virtual</code> a upravte
jej podle svÃ½ch potÅ™eb.</p>
<p><a name="directory-hierarchy"></a></p>
<h3 id="hierarchie-adresÃ¡Å™Å¯">Hierarchie adresÃ¡Å™Å¯</h3>
<p>S vÃ½chozÃ­m konfiguraÄnÃ­m souborem se pouÅ¾Ã­vÃ¡ nÃ¡sledujÃ­cÃ­ hierarchie
adresÃ¡Å™Å¯:</p>
<pre><code>     /void-packages
        |- common
        |- etc
        |- srcpkgs
        |  |- xbps
        |     |- template
        |
        |- hostdir
        |  |- binpkgs ...
        |  |- ccache ...
        |  |- distcc-&lt;arch&gt; ...
        |  |- repocache ...
        |  |- sources ...
        |
        |- masterdir-&lt;arch&gt;
        |  |- builddir -&gt; ...
        |  |- destdir -&gt; ...
        |  |- host -&gt; bind mounted from &lt;hostdir&gt;
        |  |- void-packages -&gt; bind mounted from &lt;void-packages&gt;</code></pre>
<p>Popis tÄ›chto adresÃ¡Å™Å¯ je nÃ¡sledujÃ­cÃ­:</p>
<ul>
<li><code>masterdir-&lt;arch&gt;</code> : hlavnÃ­ adresÃ¡Å™, kterÃ½ mÃ¡ bÃ½t
pouÅ¾it jako rootfs k sestavenÃ­/instalaci balÃ­ÄkÅ¯.</li>
<li><code>builddir</code> : k rozbalenÃ­ tarballÅ¯ se zdrojovÃ½mi kÃ³dy a
umÃ­stÄ›nÃ­ balÃ­ÄkÅ¯.</li>
<li><code>destdir</code> : k instalaci balÃ­ÄkÅ¯ alias <strong>fake
destdir</strong> .</li>
<li><code>hostdir/ccache</code> : k uklÃ¡dÃ¡nÃ­ dat ccache, pokud je
povolena volba <code>XBPS_CCACHE</code> .</li>
<li><code>hostdir/distcc-&lt;arch&gt;</code> : k uklÃ¡dÃ¡nÃ­ dat distcc,
pokud je povolena volba <code>XBPS_DISTCC</code> .</li>
<li><code>hostdir/repocache</code> : k uklÃ¡dÃ¡nÃ­ binÃ¡rnÃ­ch balÃ­ÄkÅ¯ ze
vzdÃ¡lenÃ½ch ÃºloÅ¾iÅ¡Å¥.</li>
<li><code>hostdir/sources</code> : k uloÅ¾enÃ­ zdrojÅ¯ balÃ­ÄkÅ¯.</li>
<li><code>hostdir/binpkgs</code> : mÃ­stnÃ­ ÃºloÅ¾iÅ¡tÄ› pro uklÃ¡dÃ¡nÃ­
generovanÃ½ch binÃ¡rnÃ­ch balÃ­ÄkÅ¯.</li>
</ul>
<p><a name="building-packages"></a></p>
<h3 id="stavebnÃ­-balÃ­Äky">StavebnÃ­ balÃ­Äky</h3>
<p>NejjednoduÅ¡Å¡Ã­ forma sestavenÃ­ balÃ­Äku se dosÃ¡hne spuÅ¡tÄ›nÃ­m cÃ­le
<code>pkg</code> v <code>xbps-src</code> :</p>
<pre><code>$ cd void-packages
$ ./xbps-src pkg &lt;pkgname&gt;</code></pre>
<p>Po vytvoÅ™enÃ­ balÃ­Äku a jeho poÅ¾adovanÃ½ch zÃ¡vislostÃ­ budou binÃ¡rnÃ­
balÃ­Äky vytvoÅ™eny a zaregistrovÃ¡ny ve vÃ½chozÃ­m mÃ­stnÃ­m ÃºloÅ¾iÅ¡ti na
<code>hostdir/binpkgs</code> ; cestu k tomuto lokÃ¡lnÃ­mu ÃºloÅ¾iÅ¡ti lze
pÅ™idat do libovolnÃ©ho konfiguraÄnÃ­ho souboru xbps (viz xbps.d(5)) nebo
je explicitnÄ› pÅ™idat pomocÃ­ cmdline, tj.</p>
<pre><code>$ xbps-install --repository=hostdir/binpkgs ...
$ xbps-query --repository=hostdir/binpkgs ...</code></pre>
<p>Ve vÃ½chozÃ­m nastavenÃ­ se <strong>xbps-src</strong> pokusÃ­ vyÅ™eÅ¡it
zÃ¡vislosti balÃ­ÄkÅ¯ v tomto poÅ™adÃ­:</p>
<ul>
<li>Pokud v mÃ­stnÃ­m ÃºloÅ¾iÅ¡ti existuje zÃ¡vislost, pouÅ¾ijte ji (
<code>hostdir/binpkgs</code> ).</li>
<li>Pokud ve vzdÃ¡lenÃ©m ÃºloÅ¾iÅ¡ti existuje zÃ¡vislost, pouÅ¾ijte ji.</li>
<li>Pokud ve zdrojovÃ©m balÃ­Äku existuje zÃ¡vislost, pouÅ¾ijte ji.</li>
</ul>
<p>PouÅ¾itÃ­m vzdÃ¡lenÃ½ch ÃºloÅ¾iÅ¡Å¥ je moÅ¾nÃ© se zcela vyhnout pouÅ¾itÃ­m
parametru <code>-N</code> .</p>
<blockquote>
<p>VÃ½chozÃ­ mÃ­stnÃ­ ÃºloÅ¾iÅ¡tÄ› mÅ¯Å¾e obsahovat vÃ­ce <em>dÃ­lÄÃ­ch
repozitÃ¡Å™Å¯</em> : <code>debug</code> , <code>multilib</code> atd.</p>
</blockquote>
<p><a name="build-options"></a></p>
<h3 id="moÅ¾nosti-sestavenÃ­-balÃ­Äku">MoÅ¾nosti sestavenÃ­ balÃ­Äku</h3>
<p>PodporovanÃ© moÅ¾nosti sestavenÃ­ pro zdrojovÃ½ balÃ­Äek lze zobrazit
pomocÃ­ <code>xbps-src show-options</code> :</p>
<pre><code>$ ./xbps-src show-options foo</code></pre>
<p>MoÅ¾nosti sestavenÃ­ lze povolit pomocÃ­ parametru <code>-o</code>
<code>xbps-src</code> :</p>
<pre><code>$ ./xbps-src -o option,option1 pkg foo</code></pre>
<p>MoÅ¾nosti sestavenÃ­ lze zakÃ¡zat jejich pÅ™idÃ¡nÃ­m pÅ™edponu
<code>~</code> :</p>
<pre><code>$ ./xbps-src -o ~option,~option1 pkg foo</code></pre>
<p>Oba zpÅ¯soby lze pouÅ¾Ã­t spoleÄnÄ› k povolenÃ­ a/nebo zakÃ¡zÃ¡nÃ­ vÃ­ce
moÅ¾nostÃ­ souÄasnÄ› s <code>xbps-src</code> :</p>
<pre><code>$ ./xbps-src -o option,~option1,~option2 pkg foo</code></pre>
<p>MoÅ¾nosti sestavenÃ­ lze takÃ© zobrazit pro binÃ¡rnÃ­ balÃ­Äky pomocÃ­
<code>xbps-query(1)</code> :</p>
<pre><code>$ xbps-query -R --property=build-options foo</code></pre>
<blockquote>
<p>POZNÃMKA: Pokud vytvoÅ™Ã­te balÃ­Äek s vlastnÃ­ moÅ¾nostÃ­ a tento balÃ­Äek
je dostupnÃ½ v oficiÃ¡lnÃ­m neplatnÃ©m ÃºloÅ¾iÅ¡ti, aktualizace bude tyto
moÅ¾nosti ignorovat. PÅ™epnÄ›te tento balÃ­Äek do reÅ¾imu <code>hold</code>
pomocÃ­ <code>xbps-pkgdb(1)</code> , tj.
<code>xbps-pkgdb -m hold foo</code> pro ignorovÃ¡nÃ­ aktualizacÃ­ pomocÃ­
<code>xbps-install -u</code> . Jakmile je balÃ­Äek <code>hold</code> ,
jedinÃ½ zpÅ¯sob, jak jej aktualizovat, je explicitnÄ› jej deklarovat:
<code>xbps-install -u foo</code> .</p>
</blockquote>
<p>TrvalÃ© globÃ¡lnÃ­ moÅ¾nosti sestavenÃ­ balÃ­Äku lze nastavit pomocÃ­
promÄ›nnÃ© <code>XBPS_PKG_OPTIONS</code> v konfiguraÄnÃ­m souboru
<code>etc/conf</code> . MoÅ¾nosti sestavenÃ­ pro jednotlivÃ© balÃ­Äky lze
nastavit pomocÃ­ <code>XBPS_PKG_OPTIONS_&lt;pkgname&gt;</code> .</p>
<blockquote>
<p>POZNÃMKA: Pokud <code>pkgname</code> obsahuje <code>dashes</code> ,
mÄ›ly by bÃ½t nahrazeny <code>underscores</code> , tj
<code>XBPS_PKG_OPTIONS_xorg_server=opt</code> .</p>
</blockquote>
<p>Seznam podporovanÃ½ch voleb sestavenÃ­ balÃ­Äku a jeho popis je
definovÃ¡n v souboru <code>common/options.description</code> nebo v
souboru <code>template</code> .</p>
<p><a name="sharing-and-signing"></a></p>
<h3 id="sdÃ­lenÃ­-a-podepisovÃ¡nÃ­-mÃ­stnÃ­ch-ÃºloÅ¾iÅ¡Å¥">SdÃ­lenÃ­ a podepisovÃ¡nÃ­
mÃ­stnÃ­ch ÃºloÅ¾iÅ¡Å¥</h3>
<p>Chcete-li vzdÃ¡lenÄ› sdÃ­let mÃ­stnÃ­ ÃºloÅ¾iÅ¡tÄ›, je nutnÃ© jej podepsat a
binÃ¡rnÃ­ balÃ­Äky v nÄ›m uloÅ¾enÃ©. Toho lze dosÃ¡hnout pomocÃ­ nÃ¡stroje
<code>xbps-rindex(1)</code> .</p>
<p>Nejprve je tÅ™eba vytvoÅ™it klÃ­Ä RSA pomocÃ­ <code>openssl(1)</code>
nebo <code>ssh-keygen(1)</code> :</p>
<pre><code>$ openssl genrsa -des3 -out privkey.pem 4096</code></pre>
<p>nebo</p>
<pre><code>$ ssh-keygen -t rsa -b 4096 -m PEM -f privkey.pem</code></pre>
<blockquote>
<p>xbps aktuÃ¡lnÄ› pÅ™ijÃ­mÃ¡ pouze klÃ­Äe RSA ve formÃ¡tu PEM.</p>
</blockquote>
<p>Jakmile je soukromÃ½ klÃ­Ä RSA pÅ™ipraven, mÅ¯Å¾ete jej pouÅ¾Ã­t k
inicializaci metadat ÃºloÅ¾iÅ¡tÄ›:</p>
<pre><code>$ xbps-rindex --sign --signedby &quot;I&#39;m Groot&quot; --privkey privkey.pem $PWD/hostdir/binpkgs</code></pre>
<p>A pak udÄ›lejte podpis na balÃ­Äek:</p>
<pre><code>$ xbps-rindex --sign-pkg --privkey privkey.pem $PWD/hostdir/binpkgs/*.xbps</code></pre>
<blockquote>
<p>Pokud nenÃ­ --privkey nastaveno, vÃ½chozÃ­ je <code>~/.ssh/id_rsa</code>
.</p>
</blockquote>
<p>Pokud byl klÃ­Ä RSA chrÃ¡nÄ›n pÅ™Ã­stupovou frÃ¡zÃ­, budete ji muset zadat
nebo ji nastavit pomocÃ­ promÄ›nnÃ© prostÅ™edÃ­ <code>XBPS_PASSPHRASE</code>
.</p>
<p>Jakmile jsou binÃ¡rnÃ­ balÃ­Äky podepsÃ¡ny, zkontrolujte, zda ÃºloÅ¾iÅ¡tÄ›
obsahuje pÅ™Ã­sluÅ¡nÃ½ <code>hex fingerprint</code> :</p>
<pre><code>$ xbps-query --repository=hostdir/binpkgs -vL
...</code></pre>
<p>PokaÅ¾dÃ©, kdyÅ¾ je vytvoÅ™en binÃ¡rnÃ­ balÃ­Äek, musÃ­ bÃ½t vytvoÅ™en podpis
balÃ­Äku pomocÃ­ <code>--sign-pkg</code> .</p>
<blockquote>
<p>NenÃ­ moÅ¾nÃ© podepsat ÃºloÅ¾iÅ¡tÄ› pomocÃ­ vÃ­ce RSA klÃ­ÄÅ¯.</p>
</blockquote>
<p>Pokud jsou podepsÃ¡ny balÃ­Äky v <code>hostdir/binpkgs</code> , klÃ­Ä ve
formÃ¡tu <code>.plist</code> (importovanÃ½ xbps) lze umÃ­stit do
<code>etc/repo-keys/</code> aby xbps-src nevyzval k importu tohoto
klÃ­Äe.</p>
<p><a name="rebuilding"></a></p>
<h3
id="opÄ›tovnÃ©-sestavenÃ­-a-pÅ™epsÃ¡nÃ­-existujÃ­cÃ­ch-mÃ­stnÃ­ch-balÃ­ÄkÅ¯">OpÄ›tovnÃ©
sestavenÃ­ a pÅ™epsÃ¡nÃ­ existujÃ­cÃ­ch mÃ­stnÃ­ch balÃ­ÄkÅ¯</h3>
<p>BalÃ­Äky se pÅ™i kaÅ¾dÃ©m sestavenÃ­ pÅ™episujÃ­, aby bylo zÃ­skÃ¡nÃ­ balÃ­Äku
se zmÄ›nÄ›nÃ½mi moÅ¾nostmi sestavenÃ­ snadnÃ©. Aby xbps-src pÅ™eskoÄilo
sestavenÃ­ a zachovalo prvnÃ­ sestavenÃ­ balÃ­Äku s danou verzÃ­ a revizÃ­,
stejnÄ› jako v oficiÃ¡lnÃ­m neplatnÃ©m repozitÃ¡Å™i, nastavte
<code>XBPS_PRESERVE_PKGS=yes</code> v souboru <code>etc/conf</code>
.</p>
<p>PÅ™einstalaci balÃ­Äku do cÃ­lovÃ©ho <code>rootdir</code> lze takÃ© snadno
provÃ©st:</p>
<pre><code>$ xbps-install --repository=/path/to/local/repo -yf xbps-0.25_1</code></pre>
<p>DvojitÃ© pouÅ¾itÃ­ parametru <code>-f</code> pÅ™epÃ­Å¡e konfiguraÄnÃ­
soubory.</p>
<blockquote>
<p>VezmÄ›te prosÃ­m na vÄ›domÃ­, Å¾e <code>package expression</code> musÃ­ bÃ½t
sprÃ¡vnÄ› definovÃ¡n, aby bylo moÅ¾nÃ© balÃ­k explicitnÄ› vyzvednou z
poÅ¾adovanÃ©ho ÃºloÅ¾iÅ¡tÄ›.</p>
</blockquote>
<p><a name="distcc"></a></p>
<h3 id="povolenÃ­-distcc-pro-distribuovanou-kompilaci">PovolenÃ­ distcc
pro distribuovanou kompilaci</h3>
<p>Nastavte pracovnÃ­ky (stroje, kterÃ© budou kompilovat kÃ³d):</p>
<pre><code># xbps-install -Sy distcc</code></pre>
<p>Aktualizace whitelistu kompilÃ¡toru distcc</p>
<pre><code># update-distcc-symlinks</code></pre>
<p>Upravte konfiguraci tak, aby vaÅ¡e mÃ­stnÃ­ sÃ­Å¥ovÃ© poÄÃ­taÄe mohly
pouÅ¾Ã­vat distcc (napÅ™. <code>192.168.2.0/24</code> ):</p>
<pre><code># echo &quot;192.168.2.0/24&quot; &gt;&gt; /etc/distcc/clients.allow</code></pre>
<p>Povolte a spusÅ¥te sluÅ¾bu <code>distccd</code> :</p>
<pre><code># ln -s /etc/sv/distccd /var/service</code></pre>
<p>Nainstalujte distcc takÃ© na hostitele (stroj, kterÃ½ spouÅ¡tÃ­
xbps-src). Pokud nechcete pouÅ¾Ã­vat hostitele jako pracovnÃ­ka z jinÃ½ch
poÄÃ­taÄÅ¯, nenÃ­ tÅ™eba upravovat konfiguraci.</p>
<p>Na hostiteli nynÃ­ mÅ¯Å¾ete povolit distcc v souboru
<code>void-packages/etc/conf</code> :</p>
<pre><code>XBPS_DISTCC=yes
XBPS_DISTCC_HOSTS=&quot;localhost/2 --localslots_cpp=24 192.168.2.101/9 192.168.2.102/2&quot;
XBPS_MAKEJOBS=16</code></pre>
<p>Hodnoty pÅ™Ã­kladu pÅ™edpoklÃ¡dajÃ­ CPU localhost se 4 jÃ¡dry, z nichÅ¾
nejvÃ½Å¡e 2 se pouÅ¾Ã­vajÃ­ pro Ãºlohy kompilÃ¡toru. PoÄet slotÅ¯ pro Ãºlohy
preprocesoru je nastaven na 24, aby bylo k dispozici dostatek
pÅ™edzpracovanÃ½ch dat pro ostatnÃ­ CPU ke kompilaci. PracovnÃ­k
192.168.2.101 mÃ¡ CPU s 8 jÃ¡dry a /9 pro poÄet Ãºloh je saturujÃ­cÃ­ volba.
PracovnÃ­k 192.168.2.102 je nastaven tak, aby spouÅ¡tÄ›l maximÃ¡lnÄ› 2
kompilaÄnÃ­ Ãºlohy, aby byla jeho zÃ¡tÄ›Å¾ nÃ­zkÃ¡, i kdyÅ¾ mÃ¡ CPU 4 jÃ¡dra.
NastavenÃ­ XBPS_MAKEJOBS je zvÃ½Å¡eno na 16, aby se zohlednil moÅ¾nÃ½
paralelismus (2 + 9 + 2 + urÄitÃ¡ prodleva).</p>
<p><a name="distfiles-mirrors"></a></p>
<h3 id="zrcadla-distfiles">Zrcadla Distfiles</h3>
<p>V etc/conf mÅ¯Å¾ete volitelnÄ› definovat zrcadlo nebo seznam zrcadel pro
vyhledÃ¡vÃ¡nÃ­ souborÅ¯ distfiles.</p>
<pre><code>$ echo &#39;XBPS_DISTFILES_MIRROR=&quot;ftp://192.168.100.5/gentoo/distfiles&quot;&#39; &gt;&gt; etc/conf</code></pre>
<p>Pokud mÃ¡ bÃ½t prohledÃ¡no vÃ­ce neÅ¾ jedno zrcadlo, mÅ¯Å¾ete buÄ zadat vÃ­ce
adres URL oddÄ›lenÃ½ch mezerami, nebo pÅ™idat do promÄ›nnÃ© takto</p>
<pre><code>$ echo &#39;XBPS_DISTFILES_MIRROR+=&quot; https://sources.voidlinux.org/&quot;&#39; &gt;&gt; etc/conf</code></pre>
<p>V tomto pÅ™Ã­padÄ› nezapomeÅˆte za prvnÃ­ dvojitou uvozovku vloÅ¾it
mezeru.</p>
<p>Zrcadla jsou prohledÃ¡na, aby distfiles vytvoÅ™ily balÃ­Äek, dokud
kontrolnÃ­ souÄet staÅ¾enÃ©ho souboru neodpovÃ­dÃ¡ tomu, kterÃ½ je uveden v
Å¡ablonÄ›.</p>
<p>Nakonec, pokud Å¾Ã¡dnÃ© zrcadlo nenese distfile, nebo v pÅ™Ã­padÄ›, Å¾e
vÅ¡echna stahovÃ¡nÃ­ selhala pÅ™i ovÄ›Å™enÃ­ kontrolnÃ­ho souÄtu, pouÅ¾ije se
pÅ¯vodnÃ­ umÃ­stÄ›nÃ­ stahovÃ¡nÃ­.</p>
<p>Pokud pro XBPS_CHROOT_CMD pouÅ¾Ã­vÃ¡te <code>uchroot</code> , mÅ¯Å¾ete
takÃ© zadat mÃ­stnÃ­ cestu pomocÃ­ pÅ™edpony <code>file://</code> nebo
jednoduÅ¡e absolutnÃ­ cestu na hostiteli sestavenÃ­ (napÅ™. /mnt/distfiles).
Takto zadanÃ¡ zrcadlovÃ¡ umÃ­stÄ›nÃ­ jsou pÅ™ipojena do chrootovÃ©ho prostÅ™edÃ­
pod $XBPS_MASTERDIR a vyhledÃ¡vajÃ­ distfiles stejnÄ› jako vzdÃ¡lenÃ¡
umÃ­stÄ›nÃ­.</p>
<p><a name="cross-compiling"></a></p>
<h3 id="kÅ™Ã­Å¾ovÃ¡-kompilace-balÃ­ÄkÅ¯-pro-cÃ­lovou-architekturu">KÅ™Ã­Å¾ovÃ¡
kompilace balÃ­ÄkÅ¯ pro cÃ­lovou architekturu</h3>
<p>V souÄasnÃ© dobÄ› mÅ¯Å¾e <code>xbps-src</code> kÅ™Ã­Å¾it sestavenÃ­ balÃ­ÄkÅ¯
pro nÄ›kterÃ© cÃ­lovÃ© architektury pomocÃ­ kÅ™Ã­Å¾ovÃ©ho kompilÃ¡toru.
PodporovanÃ½ cÃ­l je zobrazen pomocÃ­ <code>./xbps-src -h</code> .</p>
<p>Pokud byl zdrojovÃ½ balÃ­Äek upraven tak, aby byl <strong>kÅ™Ã­Å¾ovÄ›
sestavitelnÃ½,</strong> <code>xbps-src</code> automaticky sestavÃ­ binÃ¡rnÃ­
balÃ­Äky pomocÃ­ jednoduchÃ©ho pÅ™Ã­kazu:</p>
<pre><code>$ ./xbps-src -a &lt;target&gt; pkg &lt;pkgname&gt;</code></pre>
<p>Pokud sestavenÃ­ z jakÃ©hokoli dÅ¯vodu selÅ¾e, mÅ¯Å¾e to bÃ½t problÃ©m novÃ©ho
sestavenÃ­ nebo jednoduÅ¡e proto, Å¾e nebylo upraveno pro <strong>kÅ™Ã­Å¾ovou
kompilaci</strong> .</p>
<p><a name="foreign"></a></p>
<h3 id="pouÅ¾itÃ­-xbps-src-v-zahraniÄnÃ­-distribuci-linuxu">PouÅ¾itÃ­
xbps-src v zahraniÄnÃ­ distribuci Linuxu</h3>
<p>xbps-src lze pouÅ¾Ã­t v jakÃ©koli nedÃ¡vnÃ© distribuci Linuxu odpovÃ­dajÃ­cÃ­
architektuÅ™e CPU.</p>
<p>Chcete-li pouÅ¾Ã­t xbps-src ve vaÅ¡Ã­ distribuci Linuxu, postupujte podle
nÃ¡sledujÃ­cÃ­ch pokynÅ¯. ZaÄnÄ›me stahovat statickÃ© binÃ¡rnÃ­ soubory
xbps:</p>
<pre><code>$ wget http://repo-default.voidlinux.org/static/xbps-static-latest.&lt;arch&gt;-musl.tar.xz
$ mkdir ~/XBPS
$ tar xvf xbps-static-latest.&lt;arch&gt;-musl.tar.xz -C ~/XBPS
$ export PATH=~/XBPS/usr/bin:$PATH</code></pre>
<p>Pokud <code>xbps-uunshare</code> nefunguje kvÅ¯li nedostatku podpory
<code>user_namespaces(7)</code> , zkuste jinÃ© <a
href="#chroot-methods">chroot metody</a> .</p>
<p>Naklonujte <code>void-packages</code> git repozitÃ¡Å™:</p>
<pre><code>$ git clone https://github.com/void-linux/void-packages.git</code></pre>
<p>a <code>xbps-src</code> by mÄ›l bÃ½t plnÄ› funkÄnÃ­; volitelnÄ› spusÅ¥te
proces <code>bootstrap</code> , tj.:</p>
<pre><code>$ ./xbps-src binary-bootstrap</code></pre>
<p>VÃ½chozÃ­ masterdir je vytvoÅ™en v aktuÃ¡lnÃ­m pracovnÃ­m adresÃ¡Å™i, tj
<code>void-packages/masterdir-&lt;arch&gt;</code> , kde
<code>&lt;arch&gt;</code> pro vÃ½chozÃ­ masterdir je nativnÃ­ architektura
xbps.</p>
<p><a name="remaking-masterdir"></a></p>
<h3 id="pÅ™edÄ›lat-masterdir">PÅ™edÄ›lat masterdir</h3>
<p>Pokud z nÄ›jakÃ©ho dÅ¯vodu musÃ­te aktualizovat xbps-src a cÃ­l
<code>bootstrap-update</code> nestaÄÃ­, je moÅ¾nÃ© znovu vytvoÅ™it masterdir
pomocÃ­ dvou jednoduchÃ½ch pÅ™Ã­kazÅ¯ (vÅ¡imnÄ›te si prosÃ­m, Å¾e
<code>zap</code> udrÅ¾uje vaÅ¡e adresÃ¡Å™e <code>ccache/distcc/host</code>
nedotÄenÃ©):</p>
<pre><code>$ ./xbps-src zap
$ ./xbps-src binary-bootstrap</code></pre>
<p><a name="updating-masterdir"></a></p>
<h3 id="udrÅ¾ujte-svÅ¯j-masterdir-aktuÃ¡lnÃ­">UdrÅ¾ujte svÅ¯j masterdir
aktuÃ¡lnÃ­</h3>
<p>NÄ›kdy musÃ­ bÃ½t balÃ­Äky bootstrap aktualizovÃ¡ny na nejnovÄ›jÅ¡Ã­
dostupnou verzi v repozitÃ¡Å™Ã­ch, to se provÃ¡dÃ­ pomocÃ­ cÃ­le
<code>bootstrap-update</code> :</p>
<pre><code>$ ./xbps-src bootstrap-update</code></pre>
<p><a name="building-32bit"></a></p>
<h3 id="vytvÃ¡Å™enÃ­-32bitovÃ½ch-balÃ­ÄkÅ¯-na-x86_64">VytvÃ¡Å™enÃ­ 32bitovÃ½ch
balÃ­ÄkÅ¯ na x86_64</h3>
<p>K sestavenÃ­ 32bitovÃ½ch balÃ­ÄkÅ¯ na x86_64 jsou k dispozici dva
zpÅ¯soby:</p>
<ul>
<li>nativnÃ­ reÅ¾im s 32bitovÃ½m masterdirem (doporuÄeno, pouÅ¾Ã­vÃ¡ se v
oficiÃ¡lnÃ­m ÃºloÅ¾iÅ¡ti)</li>
<li>reÅ¾im kÅ™Ã­Å¾ovÃ© kompilace na <a href="#cross-compiling">cÃ­l</a>
i686</li>
</ul>
<p>KanonickÃ½ reÅ¾im (nativnÃ­) potÅ™ebuje novÃ½ x86 <code>masterdir</code> ,
kterÃ½ se vytvoÅ™Ã­ pÅ™i sestavovÃ¡nÃ­ balÃ­Äku pro i686:</p>
<pre><code>$ ./xbps-src -A i686 ...</code></pre>
<p><a name="building-for-musl"></a></p>
<h3 id="nativnÃ­-vytvÃ¡Å™enÃ­-balÃ­ÄkÅ¯-pro-knihovnu-musl-c">NativnÃ­ vytvÃ¡Å™enÃ­
balÃ­ÄkÅ¯ pro knihovnu musl C</h3>
<p>KanonickÃ½ zpÅ¯sob sestavovÃ¡nÃ­ balÃ­ÄkÅ¯ pro stejnou architekturu, ale s
jinou knihovnou C, je pomocÃ­ vyhrazenÃ©ho hlavnÃ­ho adresÃ¡Å™e (masterdir) s
pouÅ¾itÃ­m pÅ™Ã­znaku architektury hostitele <code>-A</code> . Pro sestavenÃ­
pro x86_64-musl na systÃ©mu glibc x86_64 pouÅ¾ijte
<code>-A x86_64-musl</code> ve volÃ¡nÃ­ <code>xbps-src</code> . TÃ­m se
vytvoÅ™Ã­ a nabootuje novÃ½ hlavnÃ­ adresÃ¡Å™ s nÃ¡zvem
<code>masterdir-x86_64-musl</code> , kterÃ½ bude pouÅ¾it, kdyÅ¾ je zadÃ¡n
<code>-A x86_64-musl</code> :</p>
<pre><code>$ ./xbps-src -A x86_64-musl pkg ...</code></pre>
<p><a name="building-base-system"></a></p>
<h3 id="budovÃ¡nÃ­-prÃ¡zdnÃ©ho-zÃ¡kladnÃ­ho-systÃ©mu-od-nuly">BudovÃ¡nÃ­
prÃ¡zdnÃ©ho zÃ¡kladnÃ­ho systÃ©mu od nuly</h3>
<p>Chcete-li znovu sestavit vÅ¡echny balÃ­Äky v <code>base-system</code>
pro vaÅ¡i nativnÃ­ architekturu:</p>
<pre><code>$ ./xbps-src -N pkg base-system</code></pre>
<p>Je takÃ© moÅ¾nÃ© kÅ™Ã­Å¾ovÄ› kompilovat vÅ¡e od zaÄÃ¡tku:</p>
<pre><code>$ ./xbps-src -a &lt;target&gt; -N pkg base-system</code></pre>
<p>Po dokonÄenÃ­ sestavenÃ­ mÅ¯Å¾ete zadat cestu k mÃ­stnÃ­mu ÃºloÅ¾iÅ¡ti
<code>void-mklive</code> , tj.</p>
<pre><code># cd void-mklive
# make
# ./mklive.sh ... -r /path/to/hostdir/binpkgs</code></pre>
<script>
(function () {
  function hexToRgb(hex) {
    hex = hex.trim().replace(/^#/, '');
    if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
    const n = parseInt(hex, 16);
    return [n >> 16 & 255, n >> 8 & 255, n & 255];
  }

  function clamp(v, min, max) {
    return Math.min(Math.max(v, min), max);
  }

  function Color(r, g, b) {
    this.r = r / 255;
    this.g = g / 255;
    this.b = b / 255;
  }

  Color.prototype.applyFilter = function (funcs) {
    let [r, g, b] = [this.r * 255, this.g * 255, this.b * 255];

    function multiply(matrix) {
      const nr = clamp(r * matrix[0] + g * matrix[1] + b * matrix[2], 0, 255);
      const ng = clamp(r * matrix[3] + g * matrix[4] + b * matrix[5], 0, 255);
      const nb = clamp(r * matrix[6] + g * matrix[7] + b * matrix[8], 0, 255);
      r = nr; g = ng; b = nb;
    }

    function hueRotate(angle) {
      const a = angle / 180 * Math.PI;
      const sin = Math.sin(a), cos = Math.cos(a);
      multiply([
        0.213 + cos*0.787 - sin*0.213, 0.715 - cos*0.715 - sin*0.715, 0.072 - cos*0.072 + sin*0.928,
        0.213 - cos*0.213 + sin*0.143, 0.715 + cos*0.285 + sin*0.140, 0.072 - cos*0.072 - sin*0.283,
        0.213 - cos*0.213 - sin*0.787, 0.715 - cos*0.715 + sin*0.715, 0.072 + cos*0.928 + sin*0.072,
      ]);
    }

    function sepia(v) {
      multiply([
        0.393 + 0.607*(1-v), 0.769 - 0.769*(1-v), 0.189 - 0.189*(1-v),
        0.349 - 0.349*(1-v), 0.686 + 0.314*(1-v), 0.168 - 0.168*(1-v),
        0.272 - 0.272*(1-v), 0.534 - 0.534*(1-v), 0.131 + 0.869*(1-v),
      ]);
    }

    function saturate(v) {
      multiply([
        0.213 + 0.787*v, 0.715 - 0.715*v, 0.072 - 0.072*v,
        0.213 - 0.213*v, 0.715 + 0.285*v, 0.072 - 0.072*v,
        0.213 - 0.213*v, 0.715 - 0.715*v, 0.072 + 0.928*v,
      ]);
    }

    for (const [fn, val] of funcs) {
      if (fn === 'invert')    { r = clamp((1-r/255)*255*val + r/255*255*(1-val),0,255); g = clamp((1-g/255)*255*val + g/255*255*(1-val),0,255); b = clamp((1-b/255)*255*val + b/255*255*(1-val),0,255); }
      if (fn === 'sepia')     sepia(val);
      if (fn === 'saturate')  saturate(val);
      if (fn === 'hueRotate') hueRotate(val);
      if (fn === 'brightness'){ r = clamp(r*val,0,255); g = clamp(g*val,0,255); b = clamp(b*val,0,255); }
    }

    return new Color(r, g, b);
  };

  function loss(result, target) {
    return (
      Math.pow(result.r*255 - target.r*255, 2) +
      Math.pow(result.g*255 - target.g*255, 2) +
      Math.pow(result.b*255 - target.b*255, 2)
    );
  }

  function solve(target) {
    function css(v) {
      return [
        ['invert',    clamp(v[0], 0, 1)],
        ['sepia',     clamp(v[1], 0, 1)],
        ['saturate',  clamp(v[2], 0, 20)],
        ['hueRotate', clamp(v[3], 0, 360)],
        ['brightness',clamp(v[4], 0, 10)],
        ['brightness',clamp(v[5], 0, 10)],
      ];
    }

    function score(v) {
      return loss(new Color(0,0,0).applyFilter(css(v)), target);
    }

    let best = null, bestScore = Infinity;
    for (let i = 0; i < 30; i++) {
      let v = [Math.random(), Math.random(), Math.random()*10, Math.random()*360, Math.random()*2, Math.random()*2];
      for (let step = 1; step > 0.0001; step *= 0.9) {
        for (let j = 0; j < v.length; j++) {
          const orig = v[j];
          v[j] += step * (Math.random() > 0.5 ? 1 : -1);
          const s = score(v);
          if (s < bestScore) { bestScore = s; best = [...v]; }
          else v[j] = orig;
        }
      }
    }

    const f = css(best);
    return [
      `invert(${(clamp(f[0][1],0,1)*100).toFixed(0)}%)`,
      `sepia(${(clamp(f[1][1],0,1)*100).toFixed(0)}%)`,
      `saturate(${(clamp(f[2][1],0,20)*100).toFixed(0)}%)`,
      `hue-rotate(${clamp(f[3][1],0,360).toFixed(0)}deg)`,
      `brightness(${(clamp(f[4][1],0,10)*100).toFixed(0)}%)`,
      `brightness(${(clamp(f[5][1],0,10)*100).toFixed(0)}%)`,
    ].join(' ');
  }

  // Cache solved filters per color so theme switching is instant
  const cache = {};

  function applyIconColor() {
    const raw = getComputedStyle(document.documentElement)
      .getPropertyValue('--color-icon').trim();
    if (!raw) return false;

    let rgb;
    if (raw.startsWith('#')) {
      rgb = hexToRgb(raw);
    } else if (raw.startsWith('rgb')) {
      rgb = raw.match(/\d+/g).map(Number).slice(0, 3);
    } else {
      return false;
    }

    const key = rgb.join(',');
    if (!cache[key]) {
      cache[key] = solve(new Color(...rgb));
    }

    document.documentElement.style.setProperty('--filter-icon', cache[key]);
    return true;
  }

  function init() {
    if (!applyIconColor()) return;

    // Watch for data-theme attribute changes on <html> â€” re-apply immediately
    new MutationObserver(function(mutations) {
      for (const m of mutations) {
        if (m.attributeName === 'data-theme') {
          applyIconColor();
          break;
        }
      }
    }).observe(document.documentElement, { attributes: true });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
<script data-goatcounter="https://vur.gocounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
<script src="https://giscus.app/client.js"
        data-repo="osowoso/VUR"
        data-repo-id="R_kgDOGNy3Og"
        data-category="General"
        data-category-id="DIC_kwDOGNy3Os4CBWcR"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="cs"
        crossorigin="anonymous"
        async></script>
</body>
</html>
